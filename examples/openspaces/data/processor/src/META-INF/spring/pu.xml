<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:gs-core="http://www.openspaces.org/schema/core"
       xmlns:gs-events="http://www.openspaces.org/schema/events"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.openspaces.org/schema/core http://www.openspaces.org/schema/core/openspaces-core.xsd
       http://www.openspaces.org/schema/events http://www.openspaces.org/schema/events/openspaces-events.xsd">

    <bean id="propertiesConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"/>

    <gs-core:giga-space-context/>

    <gs-core:space id="space" url="/./space" lookup-groups="${user.name}"/>

    <gs-core:giga-space id="gigaSpace" space="space"/>

    <gs-core:local-tx-manager id="transactionManager" giga-space="gigaSpace"/>

    <bean id="dataProcessor" class="org.openspaces.example.data.processor.DataProcessor"/>

    <gs-events:polling-container id="dataProcessorPollingEventContainer" giga-space="gigaSpace">
        <gs-events:tx-support tx-manager="transactionManager" />
        <gs-core:template>
            <bean class="org.openspaces.example.data.common.Data">
                <property name="processed" value="false"/>
            </bean>
        </gs-core:template>
        <gs-events:listener>
            <bean class="org.openspaces.events.adapter.AnnotationEventListenerAdapter">
                <property name="delegate" ref="dataProcessor"/>
            </bean>
        </gs-events:listener>
    </gs-events:polling-container>

    <!-- Print out all the processed data event using notifications with processed true -->
    <gs-events:notify-container id="dataProcessedCounterNotifyContainer" giga-space="gigaSpace" com-type="UNICAST">
        <gs-events:notify write="true" update="true" />
        <gs-events:batch size="10" time="5000" />
        <gs-core:sql-query where="processed = true" class="org.openspaces.example.data.common.Data" />
        <gs-events:listener>
            <bean class="org.openspaces.events.adapter.AnnotationEventListenerAdapter">
                <property name="delegate">
                    <bean class="org.openspaces.example.data.processor.DataProcessedCounter"/>
                </property>
            </bean>
        </gs-events:listener>
    </gs-events:notify-container>


    <gs-core:context-loader id="modeExample" location="classpath:/META-INF/spring/mode/mode.xml"/>

    <!-- Remoting Support -->
    <gs-events:polling-container id="remotingContainer" giga-space="gigaSpace" concurrent-consumers="2">
        <gs-events:listener>
            <bean class="org.openspaces.remoting.SpaceRemotingServiceExporter">
                <property name="services">
                    <list>
                        <ref bean="dataProcessor"/>
                    </list>
                </property>
            </bean>
        </gs-events:listener>
    </gs-events:polling-container>
</beans>