<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:gs-core="http://www.openspaces.org/schema/core"
       xmlns:gs-events="http://www.openspaces.org/schema/events"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.openspaces.org/schema/core http://www.openspaces.org/schema/core/openspaces-core.xsd
       http://www.openspaces.org/schema/events http://www.openspaces.org/schema/events/openspaces-events.xsd">

    <bean id="propertiesConfigurer" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"/>

    <gs-core:giga-space-context/>

    <gs-core:space id="space" url="/./space" lookup-groups="${user.name}"/>

    <gs-core:giga-space id="gigaSpace" space="space"/>

    <gs-core:local-tx-manager id="transactionManager" giga-space="gigaSpace"/>

    <bean id="dataProcessor" class="org.openspaces.example.data.processor.DataProcessor"/>

    <gs-events:polling-container id="dataProcessorPollingEventContainer" giga-space="gigaSpace" tx-manager="transactionManager">
        <gs-core:template>
            <bean class="org.openspaces.example.data.common.Data">
                <property name="processed" value="false"/>
            </bean>
        </gs-core:template>
        <gs-events:listener>
            <bean class="org.openspaces.events.adapter.AnnotationEventListenerAdapter">
                <property name="delegate" ref="dataProcessor"/>
            </bean>
        </gs-events:listener>
    </gs-events:polling-container>

    <!-- Print out all the processed data event using notifications with processed true -->
    <bean id="dataProcessedCounterNotifyContainer"
          class="org.openspaces.events.notify.SimpleNotifyEventListenerContainer">
        <property name="gigaSpace" ref="gigaSpace"/>

        <property name="notifyWrite" value="true"/>
        <property name="notifyUpdate" value="true"/>

        <property name="comTypeName" value="unicast"/>

        <property name="template">
            <bean class="org.openspaces.example.data.common.Data">
                <property name="processed" value="true"/>
            </bean>
        </property>

        <property name="eventListener">
            <bean class="org.openspaces.events.adapter.AnnotationEventListenerAdapter">
                <property name="delegate">
                    <bean class="org.openspaces.example.data.processor.DataProcessedCounter"/>
                </property>
            </bean>
        </property>
    </bean>

    <gs-core:context-loader id="modeExample" location="classpath:/META-INF/spring/mode/mode.xml"/>

    <!-- Remoting Support -->
    <gs-events:polling-container id="remotingContainer" giga-space="gigaSpace" concurrent-consumers="2">
        <gs-events:listener>
            <bean class="org.openspaces.remoting.SpaceRemotingServiceExporter">
                <property name="services">
                    <list>
                        <ref bean="dataProcessor"/>
                    </list>
                </property>
            </bean>
        </gs-events:listener>
    </gs-events:polling-container>
</beans>